{% extends "base.html" %}
{% load price_filters %}

{% block content %}
<section class="py-12 bg-gray-50">
  <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- تصویر محصول -->
<div class="bg-gray-100 rounded-3xl shadow-md overflow-hidden group mb-8 md:mb-0 md:col-span-1 flex items-center justify-center my-3">
  {% if product.image %}
    <img src="{{ product.image.url }}" alt="{{ product.title }}"
         class="max-h-[36rem] w-full object-contain group-hover:scale-105 transition duration-300">
  {% else %}
    <div class="w-full h-96 sm:h-[32rem] flex items-center justify-center text-gray-400">بدون تصویر</div>
  {% endif %}
</div>



    <!-- اطلاعات محصول -->
    <div class="grid grid-cols-1 md:grid-cols-2 md:gap-10 my-10 p-1">
      <!-- متن‌ها و قیمت -->
      <div class="flex flex-col justify-between">
        <div class="mb-6">
          <h1 class="text-3xl md:text-4xl font-extrabold text-gray-800">{{ product.title }}</h1>
          <p class="mt-2 inline-block bg-green-100 text-green-700 text-sm px-3 py-1 rounded-full">
            {{ product.category.title }}
          </p>
        </div>

        <!-- قیمت و انتخاب وزن/تعداد -->
        <div class="bg-white p-6 rounded-2xl shadow-md mb-6">
          {% if product.product_type == "bulk" %}
            <p class="text-2xl md:text-3xl font-bold text-green-700 mb-4">
              {{ product.price_per_kg|price }} <span class="text-lg text-gray-500">/ هر کیلو</span>
            </p>

            <label for="weight" class="text-gray-700 font-medium">وزن موردنظر:</label>
            <select id="weight" class="border rounded-lg px-4 py-2 mt-2 w-40 focus:ring-2 focus:ring-green-500">
              <option value="100">100 گرم</option>
              <option value="200">200 گرم</option>
              <option value="250">250 گرم</option>
              <option value="500">500 گرم</option>
              <option value="1000">1 کیلو</option>
              <option value="1500">1.5 کیلو</option>
              <option value="2000">2 کیلو</option>
            </select>

            <p class="mt-4 text-lg font-semibold text-gray-700">
              قیمت نهایی: <span id="calculated-price" class="text-green-700 font-bold">0</span> تومان
            </p>

            <script>
              const pricePerKg = {{ product.price_per_kg }};
              const weightSelect = document.getElementById('weight');
              const calculatedPrice = document.getElementById('calculated-price');
              function updatePrice() {
                let weight = parseFloat(weightSelect.value) || 0;
                let price = (weight / 1000) * pricePerKg;
                calculatedPrice.textContent = price.toLocaleString('fa-IR');
              }
              weightSelect.addEventListener('change', updatePrice);
              updatePrice();
            </script>

          {% elif product.product_type == "packaged" %}
            <p class="text-2xl md:text-3xl font-bold text-green-700 mb-2">
              {{ product.package_price|price }}
            </p>
            <p class="text-gray-500 mb-4">وزن هر بسته: {{ product.package_weight }} گرم</p>

            <label for="quantity" class="text-gray-700 font-medium">تعداد بسته:</label>
            <input type="number" id="quantity" min="1" value="1"
                   class="border rounded-lg px-4 py-2 mt-2 w-32 focus:ring-2 focus:ring-green-500">

            <p class="mt-4 text-lg font-semibold text-gray-700">
              قیمت کل: <span id="total-price" class="text-green-700 font-bold">0</span> تومان
            </p>

            <script>
              const packagePrice = {{ product.package_price }};
              const quantityInput = document.getElementById('quantity');
              const totalPrice = document.getElementById('total-price');
              function updatePackagedPrice() {
                let quantity = parseInt(quantityInput.value) || 0;
                let price = quantity * packagePrice;
                totalPrice.textContent = price.toLocaleString('fa-IR');
              }
              quantityInput.addEventListener('input', updatePackagedPrice);
              updatePackagedPrice();
            </script>
          {% endif %}
        </div>

        <!-- دکمه افزودن به سبد خرید -->
        <button class="w-full md:w-auto flex items-center justify-center gap-2 px-6 py-3 bg-green-600 text-white font-bold text-lg rounded-xl hover:bg-green-700 transition shadow-lg">
          <i class="fas fa-shopping-cart"></i>
          افزودن به سبد خرید
        </button>
      </div>
    </div>
  </div>

  <!-- توضیحات محصول -->
  {% if product.description %}
    <div class="max-w-6xl mx-auto mt-12 bg-white rounded-2xl shadow-md p-6">
      <h2 class="text-2xl font-extrabold text-gray-800 mb-4 border-b pb-2">توضیحات محصول</h2>
      <p class="text-gray-700 leading-relaxed">{{ product.description|linebreaks }}</p>
    </div>
  {% endif %}
</section>
{% endblock %}
