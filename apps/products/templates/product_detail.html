{% extends "base.html" %}
{% load price_filters %}

{% block content %}
<section class="py-12">
  <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">

    <!-- تصویر محصول -->
    <div class="w-full aspect-w-16 aspect-h-9 bg-gray-100 rounded-2xl overflow-hidden mb-8">
      {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.title }}" 
             class="w-full h-full object-contain object-center">
      {% else %}
        <div class="w-full h-full flex items-center justify-center text-gray-400">بدون تصویر</div>
      {% endif %}
    </div>

    <!-- عنوان و دسته‌بندی -->
    <div class="mb-6">
      <h1 class="text-3xl md:text-4xl font-semibold text-gray-800">{{ product.title }}</h1>
      <p class="text-gray-500 mt-2">{{ product.category.title }}</p>
    </div>

    <!-- قیمت و انتخاب وزن/تعداد -->
    <div class="mb-6">
      {% if product.product_type == "bulk" %}
        <p class="text-2xl md:text-3xl font-bold text-green-700 mb-2">
          قیمت هر کیلو: {{ product.price_per_kg|price }}
        </p>

        <!-- dropdown وزن مشخص -->
        <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 space-y-2 sm:space-y-0">
          <label for="weight" class="text-gray-700 font-medium">وزن:</label>
          <select id="weight" class="border rounded-md px-3 py-2 w-32">
            <option value="100">100 گرم</option>
            <option value="200">200 گرم</option>
            <option value="250">250 گرم</option>
            <option value="500">500 گرم</option>
            <option value="1000">1 کیلو</option>
            <option value="1500">1.5 کیلو</option>
            <option value="2000">2 کیلو</option>
          </select>
        </div>

        <!-- قیمت محاسبه شده -->
        <p class="mt-3 text-xl text-gray-800">
          قیمت: <span id="calculated-price">0</span> تومان
        </p>

        <script>
          const pricePerKg = {{ product.price_per_kg }};
          const weightSelect = document.getElementById('weight');
          const calculatedPrice = document.getElementById('calculated-price');

          function updatePrice() {
            let weight = parseFloat(weightSelect.value) || 0;
            let price = (weight / 1000) * pricePerKg;
            calculatedPrice.textContent = price.toLocaleString('fa-IR');
          }

          weightSelect.addEventListener('change', updatePrice);
          updatePrice();
        </script>

      {% elif product.product_type == "packaged" %}
        <p class="text-2xl md:text-3xl font-bold text-green-700 mb-2">
          قیمت هر بسته: {{ product.package_price|price }}
        </p>
        <p class="text-gray-500 mb-3">وزن بسته: {{ product.package_weight }} گرم</p>

        <!-- ورودی تعداد -->
        <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 space-y-2 sm:space-y-0">
          <label for="quantity" class="text-gray-700 font-medium">تعداد بسته:</label>
          <input type="number" id="quantity" min="1" value="1" class="border rounded-md px-3 py-2 w-32">
        </div>

        <!-- قیمت کل -->
        <p class="mt-3 text-xl text-gray-800">
          قیمت کل: <span id="total-price">0</span> تومان
        </p>

        <script>
          const packagePrice = {{ product.package_price }};
          const quantityInput = document.getElementById('quantity');
          const totalPrice = document.getElementById('total-price');

          function updatePackagedPrice() {
            let quantity = parseInt(quantityInput.value) || 0;
            let price = quantity * packagePrice;
            totalPrice.textContent = price.toLocaleString('fa-IR');
          }

          quantityInput.addEventListener('input', updatePackagedPrice);
          updatePackagedPrice();
        </script>
      {% endif %}
    </div>

    <!-- دکمه افزودن به سبد خرید -->
    <div class="mb-8">
      <button class="px-6 py-3 bg-green-600 text-white font-semibold rounded-xl hover:bg-green-700 transition">
        افزودن به سبد خرید
      </button>
    </div>

    <!-- توضیحات محصول -->
    {% if product.description %}
    <div>
      <h2 class="text-xl font-semibold text-gray-800 mb-2">توضیحات محصول</h2>
      <p class="text-gray-700 leading-relaxed">{{ product.description|linebreaks }}</p>
    </div>
    {% endif %}

  </div>
</section>
{% endblock %}
